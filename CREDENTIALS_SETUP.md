# 🔐 Credentials Setup Guide

## Overview
This document explains how to set up the required credentials for the BookMyHotel application, particularly for Azure/Microsoft Graph OAuth2 integration.

## 🚨 Security Notice
**NEVER commit actual credentials to version control!** All sensitive information should be stored in `.env` files which are excluded from git.

## Required Credentials

### Environment Variables (.env file)
Create a `.env` file in the project root with the following structure:

```env
# ================================================
# Microsoft Graph OAuth2 Configuration
# ================================================
MICROSOFT_GRAPH_CLIENT_ID=your_client_id_here
MICROSOFT_GRAPH_TENANT_ID=your_tenant_id_here
MICROSOFT_GRAPH_CLIENT_SECRET=your_client_secret_here

# ================================================
# Email Configuration
# ================================================
APP_EMAIL_FROM=your-email@yourdomain.com

# ================================================
# Database Configuration
# ================================================
SPRING_DATASOURCE_URL=jdbc:mysql://localhost:3307/bookmyhotel?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true
SPRING_DATASOURCE_USERNAME=root
SPRING_DATASOURCE_PASSWORD=password

# ================================================
# JWT Configuration
# ================================================
JWT_SECRET_KEY=your_long_secure_secret_key_here

# ================================================
# Payment Configuration
# ================================================
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key_here

# ================================================
# Application Configuration
# ================================================
APP_FRONTEND_URL=http://localhost:3000
```

## 🛠️ Setup Instructions

### 1. Azure App Registration (Automatic)
Use the provided setup script to create Azure credentials automatically:

```bash
./setup-oauth2.sh
```

This script will:
- Create an Azure AD App Registration
- Generate the required Client ID, Tenant ID, and Client Secret
- Create an `oauth2-credentials.env` file with the values
- Provide instructions for admin consent

### 2. Manual Setup
Copy the credentials from the generated file to your `.env` file:

```bash
# Copy values from oauth2-credentials.env to .env
source oauth2-credentials.env
```

### 3. Start the Application
Use the OAuth2-enabled startup script:

```bash
./start-backend-with-oauth2.sh
```

## 📁 File Structure

```
bookmyhotel/
├── .env                          # 🚨 NEVER COMMIT - Contains actual credentials
├── .env.example                  # ✅ Template file (safe to commit)
├── setup-oauth2.sh              # ✅ Script to create Azure credentials
├── start-backend-with-oauth2.sh # ✅ Startup script with environment loading
└── oauth2-credentials.env       # 🚨 Generated by setup script (excluded from git)
```

## 🔒 Security Best Practices

### Git Exclusions
The following files are automatically excluded from git via `.gitignore`:
- `.env`
- `.env.*`
- `*oauth2-credentials*`
- `*azure-credentials*`
- `*.pem`, `*.p12`, `*.pfx`

### Verification
To verify no credentials are committed:

```bash
# Check that .env is ignored
git check-ignore .env

# Verify only example files are tracked
git ls-files | grep "\.env"

# Should only show:
# .env.example
# frontend/.env.example
```

## 🌍 Environment-Specific Configurations

### Development
- Use `.env` for local development
- Use `start-backend-with-oauth2.sh` to load environment variables

### Production
- Set environment variables directly in your hosting platform
- Never use `.env` files in production deployments
- Use Azure Key Vault or similar secret management services

### CI/CD
- Store secrets in GitHub Secrets or equivalent
- Use environment-specific variable injection
- Never expose credentials in build logs

## 🆘 Troubleshooting

### Missing Credentials Error
If you see OAuth2 configuration warnings:
1. Ensure `.env` file exists in project root
2. Verify all required variables are set
3. Check that variables don't have quotes around values
4. Restart the backend application

### Permission Issues
If email sending fails:
1. Ensure admin consent has been granted in Azure portal
2. Verify the email address in `APP_EMAIL_FROM` is valid
3. Check Azure AD app permissions include Mail.Send

### Multi-Tenant Issues
If pagination shows "0-0 of 0":
1. Verify `X-Tenant-ID` headers are being sent
2. Check database contains data for the specified tenant
3. Ensure proper authentication tokens are used

## 📞 Support
For credential setup issues, refer to:
- [Azure App Registration Documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- [Microsoft Graph API Documentation](https://docs.microsoft.com/en-us/graph/)
- Project README.md for additional setup instructions
