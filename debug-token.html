<!DOCTYPE html>
<html>
<head>
    <title>Debug Frontend Token</title>
    <script>
        window.onload = function() {
            console.log('üîç Debugging frontend token...');
            
            // Get token from localStorage
            const token = localStorage.getItem('auth_token');
            
            if (!token) {
                document.body.innerHTML = '<h2>‚ùå No token found in localStorage</h2>';
                return;
            }
            
            console.log('‚úÖ Token found');
            
            try {
                // Decode JWT token to see the claims
                const parts = token.split('.');
                if (parts.length !== 3) {
                    throw new Error('Invalid JWT format');
                }
                
                const payload = JSON.parse(atob(parts[1]));
                
                document.body.innerHTML = `
                    <h2>üîç Frontend Token Debug</h2>
                    <h3>Token Info:</h3>
                    <pre>${JSON.stringify(payload, null, 2)}</pre>
                    
                    <h3>Token (first 100 chars):</h3>
                    <pre>${token.substring(0, 100)}...</pre>
                    
                    <h3>Test Toggle API:</h3>
                    <button onclick="testToggle()">Test Toggle Product Active</button>
                    <div id="result"></div>
                `;
                
                window.testToggle = async function() {
                    const resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = '<p>üîÑ Testing...</p>';
                    
                    try {
                        const response = await fetch('http://localhost:8080/api/hotels/1/shop/products/20/toggle-active', {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            resultDiv.innerHTML = `<p>‚úÖ Success: ${JSON.stringify(result)}</p>`;
                        } else {
                            const errorText = await response.text();
                            resultDiv.innerHTML = `<p>‚ùå Error ${response.status}: ${errorText}</p>`;
                        }
                    } catch (error) {
                        resultDiv.innerHTML = `<p>‚ùå Error: ${error.message}</p>`;
                    }
                };
                
            } catch (error) {
                document.body.innerHTML = `<h2>‚ùå Error decoding token: ${error.message}</h2>`;
            }
        };
    </script>
</head>
<body>
    <p>Loading...</p>
</body>
</html>
